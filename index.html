<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài Giảng Tương Tác: Đạo Hàm Của Tích Phân (API-Powered)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
          processEscapes: true
        },
        startup: {
          ready: () => {
            MathJax.startup.defaultReady();
            MathJax.startup.promise.then(() => {
              console.log('MathJax is ready');
            });
          }
        }
      };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Custom Styles -->
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #555; }

        .slide-block { @apply p-4 border-l-4 mb-6 rounded-r-lg shadow-sm; }
        .block-info { @apply slide-block bg-blue-50 border-blue-400; }
        .block-example { @apply slide-block bg-green-50 border-green-500; }
        .block-alert { @apply slide-block bg-yellow-50 border-yellow-500; }

        .tiktok-embed { margin: 0 auto !important; }

        /* Loading spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">

    <div class="flex flex-col md:flex-row h-screen">

        <!-- Left Column: Lecture & Materials -->
        <div id="left-column" class="md:w-1/2 h-screen overflow-y-auto p-6 md:p-8 bg-white custom-scrollbar">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Bài giảng: Đạo hàm của Tích phân theo Cận số</h1>

            <!-- Supplementary Materials -->
            <div class="mb-8 border rounded-lg p-4 shadow-md">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Video tham khảo</h2>
                <blockquote class="tiktok-embed" cite="https://www.tiktok.com/@mot_chut_toan/video/7497496142406618389" data-video-id="7497496142406618389" style="max-width: 605px;min-width: 325px;" > <section> <a target="_blank" title="@mot_chut_toan" href="https://www.tiktok.com/@mot_chut_toan?refer=embed">@mot_chut_toan</a> Bản chất của ứng dụng tích phân - Xem 1 cờ líp - Hiểu hết 1 chương <a title="toán12" target="_blank" href="https://www.tiktok.com/tag/to%C3%A1n12?refer=embed">#toán12</a> <a title="ungdungtichphan" target="_blank" href="https://www.tiktok.com/tag/ungdungtichphan?refer=embed">#ungdungtichphan</a> <a title="banchatungdungtichphan" target="_blank" href="https://www.tiktok.com/tag/banchatungdungtichphan?refer=embed">#banchatungdungtichphan</a> <a title="onthidaihoc" target="_blank" href="https://www.tiktok.com/tag/onthidaihoc?refer=embed">#onthidaihoc</a> <a target="_blank" title="♬ nhạc nền  - Toanthaytin" href="https://www.tiktok.com/music/nhạc-nền-Toanthaytin-7497496600147708688?refer=embed">♬ nhạc nền  - Toanthaytin</a> </section> </blockquote> <script async src="https://www.tiktok.com/embed.js"></script>
            </div>

            <!-- Lecture Content -->
             <div>
                <h2 class="text-2xl font-bold text-gray-700 mb-4 border-b pb-2">Nội dung Bài giảng</h2>
                <div class="slide-block block-info"><h3 class="font-bold text-lg mb-2 text-blue-800">Mục tiêu bài học</h3><p>Hôm nay, chúng ta sẽ khám phá cách tính đạo hàm của một tích phân có cận là các hàm số. Mục tiêu là hiểu rõ công thức và logic đằng sau nó, vốn là sự kết hợp của hai nguyên lý cơ bản trong giải tích.</p></div>
                <div class="slide-block block-info"><h3 class="font-bold text-lg mb-2 text-blue-800">Nền tảng lý thuyết</h3><p>Phương pháp này được xây dựng dựa trên hai trụ cột chính:</p><ul class="list-disc list-inside mt-2 space-y-1"><li><b>Công thức Newton-Leibniz:</b> Liên hệ giữa tích phân xác định và nguyên hàm. $$ \int_a^b f(x)dx = F(b) - F(a) $$</li><li><b>Quy tắc chuỗi (Chain Rule):</b> Dùng để tính đạo hàm của hàm hợp. $$ \frac{d}{dt} f(g(t)) = f'(g(t)) \cdot g'(t) $$</li></ul></div>
                <div class="slide-block block-alert"><h3 class="font-bold text-lg mb-2 text-yellow-800">Công thức chính (Định lý Leibniz)</h3><p>Giả sử ta có tích phân $Y(t) = \int_{u_1(t)}^{u_2(t)} f(x) dx$.</p><p>Với điều kiện $f(x)$ liên tục và các hàm cận $u_1(t), u_2(t)$ khả vi, đạo hàm của $Y$ theo $t$ được tính như sau:</p><div class="bg-gray-100 p-3 mt-2 rounded">$$ \frac{dY}{dt} = f(u_2(t)) \cdot u'_2(t) - f(u_1(t)) \cdot u'_1(t) $$</div><p class="mt-2">Công thức này ghi nhận sự thay đổi của hàm $f$ ở hai đầu mút, và cả sự thay đổi do chính hai đầu mút đó di chuyển.</p></div>
                <div class="slide-block block-example"><h3 class="font-bold text-lg mb-2 text-green-800">Ví dụ minh họa</h3><p>Tính đạo hàm theo $t$ của tích phân: $ Y(t) = \int_{t^2}^{\sin(t)} \frac{1}{1+x^4} dx $</p><ol class="list-decimal list-inside mt-2 space-y-2"><li><b>Xác định các thành phần:</b><ul class="list-disc list-inside ml-6 bg-green-100 p-2 rounded"><li>$ f(x) = \frac{1}{1+x^4} $</li><li>Cận trên: $ u_2(t) = \sin(t) \implies u'_2(t) = \cos(t) $</li><li>Cận dưới: $ u_1(t) = t^2 \implies u'_1(t) = 2t $</li></ul></li><li><b>Áp dụng công thức:</b><p>$$ Y'(t) = \underbrace{f(u_2(t)) \cdot u'_2(t)}_{\text{Vế 1}} - \underbrace{f(u_1(t)) \cdot u'_1(t)}_{\text{Vế 2}} $$</p><p>$$ Y'(t) = \underbrace{\left(\frac{1}{1+(\sin t)^4}\right) \cdot (\cos t)}_{\text{Thay vào Vế 1}} - \underbrace{\left(\frac{1}{1+(t^2)^4}\right) \cdot (2t)}_{\text{Thay vào Vế 2}} $$</p></li><li><b>Kết quả cuối cùng:</b><p>$$ Y'(t) = \frac{\cos(t)}{1+\sin^4(t)} - \frac{2t}{1+t^8} $$</p></li></ol></div>
             </div>
        </div>

        <!-- Right Column: Interactive & Audio -->
        <div id="right-column" class="md:w-1/2 h-screen overflow-y-auto p-6 md:p-8 bg-gray-200 custom-scrollbar">
            <div class="bg-white p-4 rounded-lg shadow-md sticky top-0 z-10"><h2 class="text-xl font-semibold text-gray-700 mb-3">Âm thanh Bài giảng</h2><audio id="audio-player" controls class="w-full"><source src="audio.wav" type="audio/wav">Trình duyệt của bạn không hỗ trợ file âm thanh.</audio><div class="mt-3"><label for="audio-upload" class="text-sm font-medium text-gray-600">Hoặc tải lên tệp âm thanh khác:</label><input type="file" id="audio-upload" accept="audio/*" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"/></div></div>
            
            <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Công cụ Tương tác (Tích hợp AI)</h2>
                <p class="text-sm text-gray-600 mb-6">Nhập hàm $f(x)$ và các hàm cận. AI sẽ tự động tính đạo hàm của cận và đưa ra kết quả cuối cùng.</p>
                <div class="space-y-4">
                    <div>
                        <label for="func-f" class="block text-sm font-medium text-gray-700">Hàm $f(x)$</label>
                        <input type="text" id="func-f" value="1 / (1 + x^4)" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="func-u2" class="block text-sm font-medium text-gray-700">Cận trên $u_2(t)$</label>
                        <input type="text" id="func-u2" value="sin(t)" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                     <div>
                        <label for="func-u1" class="block text-sm font-medium text-gray-700">Cận dưới $u_1(t)$</label>
                        <input type="text" id="func-u1" value="t^2" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>

                <button id="calculate-btn" class="mt-6 w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 flex items-center justify-center space-x-2" disabled>
                     <span id="btn-text">Tính đạo hàm</span>
                     <div id="btn-loader" class="loader hidden"></div>
                </button>

                <div id="output-area" class="mt-6 border-t pt-6">
                    <h3 class="text-lg font-semibold text-gray-700">Kết quả:</h3>
                    <div id="calculation-steps" class="mt-2 p-4 bg-gray-50 rounded-lg text-gray-800 space-y-4 min-h-[100px]">
                        <p class="text-gray-500 italic">Nhập các hàm và nhấn nút để xem kết quả.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Hardcoded API Key (SECURITY RISK) ---
            const API_KEY = "AIzaSyBCPULwHerbpiYtrNPpM3xtByiaO7PK-MI";
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`;
            
            // --- Elements ---
            const audioPlayer = document.getElementById('audio-player');
            const audioUpload = document.getElementById('audio-upload');
            const calculateBtn = document.getElementById('calculate-btn');
            const outputDiv = document.getElementById('calculation-steps');
            const btnText = document.getElementById('btn-text');
            const btnLoader = document.getElementById('btn-loader');
            
            if (API_KEY && API_KEY !== "YOUR_API_KEY_HERE") {
                calculateBtn.disabled = false;
            } else {
                 outputDiv.innerHTML = `<p class="text-red-500 font-bold">Lỗi: API Key chưa được cung cấp. Vui lòng thêm key vào trong mã nguồn.</p>`;
            }

            // --- Audio Player Logic ---
            audioUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const fileURL = URL.createObjectURL(file);
                    audioPlayer.src = fileURL;
                    audioPlayer.play();
                }
            });

            // --- API Call Function to get derivative ---
            async function getDerivative(expression) {
                const prompt = `Calculate the derivative of the function "${expression}" with respect to the variable 't'. Provide only the resulting mathematical expression. For example, if the input is "t^3", the output should be "3*t^2".`;
                
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        })
                    });

                    if (!response.ok) {
                        const errorBody = await response.json();
                        console.error("API Error Response:", errorBody);
                        throw new Error(`API call failed with status: ${response.status}. ${errorBody.error?.message || 'Unknown error.'}`);
                    }

                    const data = await response.json();
                    const derivative = data.candidates[0].content.parts[0].text.trim();
                    return derivative;
                } catch (error) {
                    console.error("Error fetching derivative:", error);
                    return `Error: ${error.message}`; // Return error message on failure
                }
            }
            
            // --- Main Calculation Logic ---
            calculateBtn.addEventListener('click', async () => {
                // Show loading state
                btnText.textContent = 'Đang tính toán...';
                btnLoader.classList.remove('hidden');
                calculateBtn.disabled = true;
                outputDiv.innerHTML = '<div class="flex justify-center items-center"><div class="loader"></div></div>';

                // Get input values
                const f_x = document.getElementById('func-f').value;
                const u2_t = document.getElementById('func-u2').value;
                const u1_t = document.getElementById('func-u1').value;

                if (!f_x || !u1_t || !u2_t) {
                    outputDiv.innerHTML = '<p class="text-red-500">Vui lòng điền đầy đủ các hàm.</p>';
                    btnText.textContent = 'Tính đạo hàm';
                    btnLoader.classList.add('hidden');
                    calculateBtn.disabled = false;
                    return;
                }

                // Call API for both derivatives concurrently
                const [u1_prime_t, u2_prime_t] = await Promise.all([
                    getDerivative(u1_t),
                    getDerivative(u2_t)
                ]);

                // Check if API calls were successful
                if (u1_prime_t.startsWith('Error:') || u2_prime_t.startsWith('Error:')) {
                    outputDiv.innerHTML = `<p class="text-red-500 font-bold">Đã xảy ra lỗi khi gọi AI:</p><p class="text-red-700 text-sm mt-2">${u1_prime_t}</p><p class="text-red-700 text-sm mt-2">${u2_prime_t}</p>`;
                    btnText.textContent = 'Thử lại';
                    btnLoader.classList.add('hidden');
                    calculateBtn.disabled = false;
                    return;
                }
                
                // --- Build the output ---
                const f_u2 = f_x.replace(/x/g, `(${u2_t})`);
                const f_u1 = f_x.replace(/x/g, `(${u1_t})`);
                const displayTex = (str) => `$$${str.replace(/\*/g, ' \\cdot ')}$$`;

                let html = `
                    <div class="step"><h4 class="font-semibold">1. Xác định đạo hàm bằng AI:</h4>
                        <p class="ml-4">Đạo hàm của cận trên $u_2(t) = ${u2_t}$ là: <strong class="text-blue-600">$u'_2(t) = ${u2_prime_t}$</strong></p>
                        <p class="ml-4">Đạo hàm của cận dưới $u_1(t) = ${u1_t}$ là: <strong class="text-blue-600">$u'_1(t) = ${u1_prime_t}$</strong></p>
                    </div>
                     <div class="step"><h4 class="font-semibold">2. Tính vế thứ nhất: $f(u_2(t)) \\cdot u'_2(t)$</h4>
                        <p class="ml-4 text-green-700 font-medium">$\\Rightarrow \\left( ${f_u2} \\right) \\cdot \\left( ${u2_prime_t} \\right)$</p>
                    </div>
                    <div class="step"><h4 class="font-semibold">3. Tính vế thứ hai: $f(u_1(t)) \\cdot u'_1(t)$</h4>
                        <p class="ml-4 text-red-700 font-medium">$\\Rightarrow \\left( ${f_u1} \\right) \\cdot \\left( ${u1_prime_t} \\right)$</p>
                    </div>
                    <div class="step border-t mt-4 pt-4"><h4 class="font-semibold">4. Kết quả cuối cùng: $Y'(t)$</h4>
                        ${displayTex(`\\left( ${f_u2} \\right) \\cdot \\left( ${u2_prime_t} \\right) - \\left( ${f_u1} \\right) \\cdot \\left( ${u1_prime_t} \\right)`)}
                    </div>`;

                outputDiv.innerHTML = html;

                // Reset button state and rerender MathJax
                btnText.textContent = 'Tính đạo hàm';
                btnLoader.classList.add('hidden');
                calculateBtn.disabled = false;
                if (window.MathJax) {
                    MathJax.typesetPromise([outputDiv]).catch((err) => console.log('MathJax typeset failed: ', err));
                }
            });
        });
    </script>

</body>
</html>
